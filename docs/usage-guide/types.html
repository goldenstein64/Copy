
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>How Types are Supported by Copy &#8212; Copy TBD documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Creating classes With Copy" href="classes.html" />
    <link rel="prev" title="How to Use Copy" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="how-types-are-supported-by-copy">
<h1>How Types are Supported by Copy<a class="headerlink" href="#how-types-are-supported-by-copy" title="Permalink to this headline">¶</a></h1>
<p>The utmost requirement for being able to copy a value is whether the state of that value can be inspected and accessed.</p>
<p>These are all the Lua datatypes and whether they have state:</p>
<table class="colwidths-auto docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Datatypes</p></th>
<th class="head"><p>Has state?</p></th>
<th class="head"><p>Can copy?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>nil</p></td>
<td><p>no</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-odd"><td><p>boolean</p></td>
<td><p>no</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-even"><td><p>number</p></td>
<td><p>no</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-odd"><td><p>string</p></td>
<td><p>no</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-even"><td><p>userdata</p></td>
<td><p>no</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-odd"><td><p>function</p></td>
<td><p>yes</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-even"><td><p>thread</p></td>
<td><p>yes</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><td><p>table</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
</tr>
</tbody>
</table>
<p>Those first four values (nil, boolean, number, string) are primitives. That is, their internal state is stored <em>directly</em> inside the variable. Therefore, the thing that determines the state of these values is whatever value the variable is. And therefore, it is not the state of the value that changes, but the state of the variable, and variables are trivial to copy (<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">y</span></code>). Since the <code class="docutils literal notranslate"><span class="pre">Copy</span></code> module returns these values back to the caller, copying primitives is technically supported, but that’s not what <code class="docutils literal notranslate"><span class="pre">Copy</span></code> is used for.</p>
<p>For functions, the only state you can change is their environment through <code class="docutils literal notranslate"><span class="pre">setfenv</span></code> and <code class="docutils literal notranslate"><span class="pre">getfenv</span></code>. However in Luau, these environments are not inspectable for optimization reasons, so functions cannot be inspected, and therefore cannot be copied.</p>
<p>For userdatas in Luau, the only state you can change is their metamethods through <code class="docutils literal notranslate"><span class="pre">setmetatable</span></code> and <code class="docutils literal notranslate"><span class="pre">getmetatable</span></code>. However, their metamethods are implemented as tables, so we can say the state of a userdata depends on the state of their metamethods, which is a table. Also, due to Luau implementation, a userdata’s metatable cannot be changed, so userdatas don’t have state, just the table containing their metamethods.</p>
<p>For threads, the only state you can change is their status, visible through <code class="docutils literal notranslate"><span class="pre">coroutine.status</span></code>. This status can be changed through:</p>
<ul class="simple">
<li><p>calls to <code class="docutils literal notranslate"><span class="pre">coroutine.resume</span></code> and <code class="docutils literal notranslate"><span class="pre">coroutine.yield</span></code></p></li>
<li><p>whether the underlying function has started or ended or both.</p></li>
</ul>
<p>The most useful portion of the thread would be how far it has progressed in the underlying function implementing it, which is not exactly accessible. Since we cannot access the entirety of the thread’s state, it would be impossible to create a complete copy of the thread, so it’s just not supported.</p>
<p>This leaves tables. All other values that require an accessible state have an underlying table implementing it. A table’s state is <em>completely</em> accessible (given <code class="docutils literal notranslate"><span class="pre">__metatable</span></code> is not set on its metatable), so the <code class="docutils literal notranslate"><span class="pre">Copy</span></code> module supports copying tables.</p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">How to Use Copy</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">How Types are Supported by Copy</a></li>
<li class="toctree-l2"><a class="reference internal" href="classes.html">Creating classes With Copy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">How to Use Copy</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">How to Use Copy</a></li>
      <li>Next: <a href="classes.html" title="next chapter">Creating classes With Copy</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/usage-guide/types.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, goldenstein64.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/usage-guide/types.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>